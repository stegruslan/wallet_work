# Wallet Management API

Это приложение является RESTful API для управления кошельками, позволяющее выполнять операции депозитов и снятий, а также получать баланс кошелька. Приложение построено с использованием FastAPI и PostgreSQL, и полностью контейнеризовано с помощью Docker.

## Стек технологий

- **Backend**: FastAPI
- **Database**: PostgreSQL
- **Containerization**: Docker
- **Testing**: Pytest


## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/stegruslan/wallet_work.git

2. Установите зависимости проекта и активируйте окружение poetry.Достаточно выполнить команды:

    ```bash
    poetry install
    poetry shell
    ```
2. Убедитесь, что у вас установлен Docker и Docker Compose.
3. Создайте файл .env в корне проекта с параметрами базы данных:
    ```bash
    DB_DIALECT=postgresql+psycopg2
    DB_HOST=postgres
    DB_PORT=5432
    DB_USER=ваше_имя_пользователя
    DB_PASSWORD=ваш_пароль
    DB_NAME=ваше_имя_базы
4. Запустите приложение и базу данных с помощью Docker Compose:
    ```bash
    docker-compose up -d --build

## Эндпоинты
### 1. Создание кошелька
```POST /api/v1/wallets/```

- Ответ: Возвращает информацию о созданном кошельке (id, баланс).
### 2. Выполнение операции
```POST /api/v1/wallets/<WALLET_UUID>/operation```

- Тело запроса:

```json

{
    "operationType": "DEPOSIT" или "WITHDRAW",
    "amount": 1000
}
```
- Ответ: Возвращает обновленную информацию о кошельке.

- ### Ошибки:

    - 404: Кошелек не найден
    - 400: Недостаточно средств (для операций снятия)
### 3. Получение баланса кошелька
```GET /api/v1/wallets/{WALLET_UUID}```

- Ответ: Возвращает текущий баланс кошелька.

- Ошибки:

    - 404: Кошелек не найден

### Проблемы с конкурентной средой
Приложение разработано с учетом обработки 1000 RPS (запросов в секунду) на один кошелек. Используется механизм блокировки (with_for_update), чтобы избежать конфликтов при одновременных запросах.